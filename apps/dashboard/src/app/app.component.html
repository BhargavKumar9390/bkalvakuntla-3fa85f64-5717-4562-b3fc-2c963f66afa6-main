<header *ngIf="isAuthenticated" class="bg-white shadow">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a routerLink="/" class="text-xl font-bold">Task Manager</a>
      <a routerLink="/tasks" class="text-sm text-gray-600 hover:text-gray-800"
        >Tasks</a
      >
      <a
        *hasPermission="'VIEW_ANALYTICS'"
        routerLink="/analytics"
        class="text-sm text-gray-600 hover:text-gray-800"
        >Analytics</a
      >
      <a
        *hasPermission="'VIEW_AUDIT'"
        routerLink="/audit"
        class="text-sm text-gray-600 hover:text-gray-800"
        >Audit</a
      >
    </div>
    <div>
      <span class="inline-flex items-center gap-2">
        <span
          class="px-3 py-1.5 rounded-full text-xs font-medium"
          [ngClass]="{
            'bg-purple-100 text-purple-800': role === 'OWNER',
            'bg-blue-100 text-blue-800': role === 'ADMIN',
            'bg-gray-100 text-gray-800': role === 'VIEWER'
          }"
          title="{{ permissionsSummary }}"
        >
          <svg
            class="w-3 h-3 inline mr-1"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            />
          </svg>
          {{ role }}
          <span class="ml-2 text-xs text-gray-600">{{
            auth.user?.displayName || auth.user?.name || auth.user?.email
          }}</span>
        </span>
        <button
          mat-icon-button
          (click)="toggleTheme()"
          aria-label="Toggle theme"
          class="text-gray-600 hover:text-gray-800"
        >
          <svg
            *ngIf="!theme.isDark()"
            class="w-5 h-5"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 3v1m0 16v1m8.66-9H21M3 12H2.34M18.36 5.64l-.7.7M6.34 17.66l-.7.7M18.36 18.36l-.7-.7M6.34 6.34l-.7-.7"
            />
          </svg>
          <svg
            *ngIf="theme.isDark()"
            class="w-5 h-5"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"
            />
          </svg>
        </button>
        <button
          mat-button
          (click)="logout()"
          class="text-sm text-gray-500 hover:text-gray-700"
        >
          Logout
        </button>
      </span>
    </div>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-6">
  <router-outlet></router-outlet>
</main>
